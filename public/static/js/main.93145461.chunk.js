(this["webpackJsonpspotify-together"]=this["webpackJsonpspotify-together"]||[]).push([[0],{63:function(t,e,o){},64:function(t,e,o){},77:function(t,e,o){"use strict";o.r(e);var n=o(0),r=o(16),c=o.n(r),a=(o(63),o(20)),i=o(21),s=o(25),l=o(24),h=(o(64),o(52)),u=(o(67),o(68),o(32)),p=o(81),m=o(80),j=o(85),d=o(87),b=o(82),O=function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",o=0;o<6;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},f=function(t,e,o,n){fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify({context_uri:e,offset:{position:o-1},position_ms:n})})},g=o(79),y=o(86),x=o(1),k=function(t){return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("p",{id:"playing-from",children:"Playing from Album"}),Object(x.jsx)("b",{children:Object(x.jsx)("p",{id:"album-name",children:t.currentTrack.album.name})}),Object(x.jsx)(g.a,{id:"album-art",src:t.currentTrack.album.image,rounded:!0}),Object(x.jsx)("b",{children:Object(x.jsx)("p",{id:"song-name",children:t.currentTrack.name})}),Object(x.jsx)("div",{id:"artists-name",children:t.currentTrack.artists.map((function(e,o){return o!==t.currentTrack.artists.length-1?e.name+", ":e.name}))}),Object(x.jsx)("style",{type:"text/css",children:".progress-bar { background-color: #2ebd59; height:5px} .progress{height:5px}"}),Object(x.jsx)(y.a,{now:t.percentage}),Object(x.jsxs)("p",{id:"room-key",children:["Room Id: ",t.room.roomKey]}),t.isHost?Object(x.jsx)(m.a,{onClick:t.closeRoom,variant:"outline-warning",children:"Close Room"}):Object(x.jsx)(m.a,{onClick:t.exitRoom,variant:"outline-warning",children:"Leave Room"})]})},T=function(t){Object(s.a)(o,t);var e=Object(l.a)(o);function o(){var t;return Object(a.a)(this,o),(t=e.call(this)).closeRoom=function(){t.props.deleteRoom(t.props.room.roomKey)},t.exitRoom=function(){console.log("EXIT ROOM"),t.props.exitRoom(t.props.room.roomKey)},t.refresh=function(){t.setState({start:Date.now(),currentPosition:0}),console.log("REFRESH"),t.props.findRoom(t.props.room.roomKey),t.props.fetchPlayingTrack(t.props.room.hostToken,t.state.isHost)},t.state={start:Date.now(),currentPosition:0,currentTrack:{},isHost:!0},t.timer=null,t.tick=function(){t.setState({currentPosition:Date.now()-t.state.start+(t.props.currentTrack.progress_ms||0)})},t}return Object(i.a)(o,[{key:"componentDidUpdate",value:function(t){this.state.currentPosition>=this.props.currentTrack.duration_ms+2e3&&(this.setState({start:Date.now(),currentPosition:0,currentTrack:{}}),this.props.findRoom(this.props.room.roomKey),this.props.fetchPlayingTrack(this.props.room.hostToken,this.state.isHost))}},{key:"componentDidMount",value:function(){this.timer=setInterval(this.tick,300),this.props.room.host.spotify_id!==localStorage.getItem("spotifyUser")&&this.setState({isHost:!1}),this.props.fetchPlayingTrack(this.props.room.hostToken,this.state.isHost)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var t=this,e=+(100*this.state.currentPosition/this.props.currentTrack.duration_ms).toFixed(2);return Boolean(this.props.currentTrack.album)?Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(k,{currentTrack:this.props.currentTrack,percentage:e,room:this.props.room,closeRoom:this.closeRoom,isHost:this.state.isHost,exitRoom:this.props.exitRoom}),Object(x.jsx)(m.a,{onClick:function(e){t.refresh()},variant:"outline-success",children:"Sync"})]}):Object(x.jsx)(m.a,{onClick:function(e){t.refresh()},variant:"outline-success",children:"Sync"})}}]),o}(n.Component),R=Object(u.b)((function(t){return{currentTrack:t.playback.track,trackLoading:t.playback.loading}}),(function(t){return{fetchPlayingTrack:function(e,o){return t(function(t,e){var o;return function(n){n({type:"LOADING_CURRENT_TRACK"}),fetch("https://api.spotify.com/v1/me/player/currently-playing",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(t){return t.json()})).then((function(t){console.log(t),o={artists:t.item.artists,album:{image:t.item.album.images[0].url,name:t.item.album.name},id:t.item.id,name:t.item.name,duration_ms:t.item.duration_ms,progress_ms:t.progress_ms},n({type:"LOAD_CURRENT_TRACK_SUCCESS",track:o}),!1===e&&(n({type:"SYNC_BEGIN",track:o}),f(localStorage.getItem("spotifyAuthToken"),t.item.album.uri,t.item.track_number,t.progress_ms))})).catch((function(t){n({type:"NO_TRACK"})}))}}(e,o))},deleteRoom:function(e){return t(function(t){return function(e){e({type:"DELETE_ROOM_START"}),fetch("".concat("http://localhost:3001","/api/rooms/delete"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({room_key:t})}).then((function(t){return t.json()})).then((function(t){e({type:"DELETE_ROOM"})}))}}(e))},exitRoom:function(e){return t((function(t){t({type:"EXIT_ROOM"})}))}}}))(T),v=function(t){Object(s.a)(o,t);var e=Object(l.a)(o);function o(){var t;return Object(a.a)(this,o),(t=e.call(this)).handleOnCreateButton=function(e){t.props.createRoom(localStorage.getItem("spotifyAuthToken"))},t.onHandleSubmit=function(e){e.preventDefault(),t.props.findRoom(t.state.roomKeyText)},t.onHandleChange=function(e){console.log(e.target.value),t.setState({roomKeyText:e.target.value})},t.state={roomKeyText:""},t}return Object(i.a)(o,[{key:"render",value:function(){var t=this;return Object(x.jsxs)("div",{className:"room_container",children:[this.props.room?Object(x.jsx)(R,{room:this.props.room,findRoom:this.props.findRoom}):Object(x.jsxs)(p.a,{vertical:!0,className:"center",children:[Object(x.jsx)(m.a,{onClick:function(){t.handleOnCreateButton()},variant:"outline-light",children:"Create Room"}),Object(x.jsx)("br",{}),Object(x.jsx)("form",{onSubmit:function(e){t.onHandleSubmit(e)},children:Object(x.jsxs)(j.a,{className:"mb-3",children:[Object(x.jsx)(j.a.Text,{id:"basic-addon1"}),Object(x.jsx)(d.a,{placeholder:"Room Key","aria-label":"Room Key","aria-describedby":"basic-addon1",onChange:function(e){t.onHandleChange(e)}})]})})]}),!0===this.props.error?Object(x.jsx)(b.a,{id:"alert-warning",variant:"warning",children:"Room Not Found"}):Object(x.jsx)(x.Fragment,{})]})}}]),o}(n.Component),_=Object(u.b)((function(t){return{room:t.room.room,loading:t.room.loading,error:t.room.error}}),(function(t){return{createRoom:function(e){t(function(t){return function(e){e({type:"CREATE_ROOM_START"});var o=O();fetch("".concat("http://localhost:3001","/api/rooms/new"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({room:{room_key:o,host_token:t},spotify_id:localStorage.getItem("spotifyUser")})}).then((function(t){return t.json()})).then((function(o){e({type:"CREATE_ROOM",room:{roomKey:o.room.room_key,hostToken:t,host:o.host}})}))}}(e))},findRoom:function(e){t(function(t){return function(e){e({type:"SEARCHING_FOR_ROOM"}),fetch("".concat("http://localhost:3001","/api/rooms/").concat(t),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({room_key:t})}).then((function(t){return t.json()})).then((function(t){e({type:"ROOM_FOUND",room:{roomKey:t.room.room_key,hostToken:t.room.host_token,host:t.host}})})).catch((function(t){e({type:"ROOM_NOT_FOUND"})}))}}(e))}}}))(v),S=o(83),C=o(84),A=o(47),E=function(t){return Object(x.jsxs)("header",{children:[Object(x.jsxs)(S.a,{bg:"black",variant:"dark",expand:"true",children:[Object(x.jsx)(S.a.Brand,{href:"/",children:Object(x.jsx)(g.a,{className:"logo",src:"./images/Spotify_Logo_RGB_Green.png"})}),Object(x.jsx)(S.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(x.jsx)(S.a.Collapse,{id:"basic-navbar-nav",children:Object(x.jsxs)(C.a,{children:[Object(x.jsx)(C.a.Link,{href:"/about",children:"About"}),Object(x.jsx)(C.a.Link,{href:"/instructions",children:"Instructions"})]})})]}),Object(x.jsx)(A.a,{id:"close",variant:"white",onClick:function(e){t.logout()}})]})},N=function(t){Object(s.a)(o,t);var e=Object(l.a)(o);function o(){var t;return Object(a.a)(this,o),(t=e.call(this)).create_or_find_user=function(e){localStorage.removeItem("spotifyAuthToken"),localStorage.removeItem("spotifyUser"),function(t){var e;fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(t){return t.json()})).then((function(o){e={display_name:o.display_name,spotify_id:o.id},localStorage.setItem("spotifyUser",o.id),localStorage.setItem("spotifyAuthToken",t),fetch("".concat("http://localhost:3001","/api/users/new"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user:e})})}))}(e);var o=new Date;o.setHours(o.getHours()+1),console.log(o),t.setState({tokenExp:o.getTime()})},t.logout=function(t){localStorage.removeItem("spotifyAuthToken"),localStorage.removeItem("spotifyUser"),window.location.replace("".concat("http://localhost:3000"))},t.state={time:0,tokenExp:Date.now()+1e4},t}return Object(i.a)(o,[{key:"componentDidMount",value:function(){var t=this;this.interval=setInterval((function(){return t.setState({time:Date.now()})}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var t=this;return Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(E,{logout:this.logout}),Boolean(this.state.time<this.state.tokenExp)&&Boolean(localStorage.getItem("spotifyAuthToken"))?Object(x.jsx)(x.Fragment,{children:Object(x.jsx)(_,{})}):Object(x.jsxs)("div",{className:"Login",children:[Object(x.jsx)("br",{}),Object(x.jsx)("br",{}),Object(x.jsx)(h.b,{title:"Continue With Spotify",redirectUri:"http://localhost:3000/callback",noLogo:!0,noCookie:!0,clientID:"8211b083dda34f61a2f0dd2d8f4d70f6",className:"center",scopes:[h.a.userReadPrivate,"user-read-email","user-read-playback-state","user-modify-playback-state"],onAccessToken:function(e){t.create_or_find_user(e)}})]})]})}}]),o}(n.Component),I=o(39),w=o(56),D=o(2),M=Object(I.b)({room:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{room:"",loading:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"CREATE_ROOM_START":return Object(D.a)(Object(D.a)({},t),{},{room:t.room,loading:!0,error:!1});case"CREATE_ROOM":return Object(D.a)(Object(D.a)({},t),{},{room:e.room,loading:!1});case"DELETE_ROOM_START":return Object(D.a)(Object(D.a)({},t),{},{loading:!0});case"DELETE_ROOM":return Object(D.a)(Object(D.a)({},t),{},{room:null,loading:!1});case"SEARCHING_FOR_ROOM":return Object(D.a)(Object(D.a)({},t),{},{room:null,loading:!0,error:!1});case"ROOM_FOUND":return Object(D.a)(Object(D.a)({},t),{},{room:e.room,loading:!1,error:!1});case"ROOM_NOT_FOUND":return Object(D.a)(Object(D.a)({},t),{},{loading:!1,error:!0,room:null});case"EXIT_ROOM":return Object(D.a)(Object(D.a)({},t),{},{loading:!1,error:!1,room:null});default:return t}},playback:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{track:{},loading:!1},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"LOADING_CURRENT_TRACK":return Object(D.a)(Object(D.a)({},t),{},{track:t.track,loading:!0});case"LOAD_CURRENT_TRACK_SUCCESS":return Object(D.a)(Object(D.a)({},t),{},{track:e.track,loading:!1});case"NO_TRACK":return Object(D.a)(Object(D.a)({},t),{},{loading:!1});default:return t}}}),U=o(57),H=o(5),K=function(t){return Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(E,{}),Object(x.jsx)("h3",{className:"title",children:"About"}),Object(x.jsx)("p",{children:"Spotify Together is a web app meant to synchronize the Spotify players of several users. The end goal of this project is to integrate with Twitch Extension panels."}),Object(x.jsxs)("p",{children:["Submit bug reports ",Object(x.jsx)("a",{href:"https://github.com/jousethen/spotify-together",children:"here"})," (Although, I don't know who's going to use this at the moment."]})]})},L=function(t){return Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(E,{}),Object(x.jsx)("h3",{className:"title",children:"Instructions for Host"}),Object(x.jsxs)("ol",{children:[Object(x.jsx)("li",{children:"Log in. If you have trouble, click the X on the top left of the screen to clear your cache and attempt to log in again"}),Object(x.jsx)("li",{children:"Make sure your Spotify is currently playing music"}),Object(x.jsx)("li",{children:'Click on "Create Room"'}),Object(x.jsx)("li",{children:"Share the code shown with your friends! (Or enemies)"})]}),Object(x.jsx)("h3",{className:"title",children:"Instructions for Listener"}),Object(x.jsxs)("ol",{children:[Object(x.jsx)("li",{children:"Log in. If you have trouble, click the X on the top left of the screen to clear your cache and attempt to log in again"}),Object(x.jsx)("li",{children:"Make sure you have a room code from the Host"}),Object(x.jsx)("li",{children:"Fill out the space provided and press Enter"}),Object(x.jsx)("li",{children:"Click on the 'Sync' button to listen along with the host"})]}),Object(x.jsxs)("p",{children:["Submit bug reports ",Object(x.jsx)("a",{href:"https://github.com/jousethen/spotify-together",children:"here"})," (Although, I don't know who's going to use this at the moment."]})]})},P=Object(I.c)(M,Object(I.a)(w.a));c.a.render(Object(x.jsx)(u.a,{store:P,children:Object(x.jsx)(U.a,{children:Object(x.jsxs)(H.c,{children:[Object(x.jsx)(H.a,{path:"/",element:Object(x.jsx)(N,{})}),Object(x.jsx)(H.a,{path:"/callback",element:Object(x.jsx)(N,{})}),Object(x.jsx)(H.a,{path:"/about",element:Object(x.jsx)(K,{})}),Object(x.jsx)(H.a,{path:"/instructions",element:Object(x.jsx)(L,{})})]})})}),document.getElementById("root"))}},[[77,1,2]]]);
//# sourceMappingURL=main.93145461.chunk.js.map